<!DOCTYPE html> <html lang="zh-CN"> <author name="KoiNL, 锦鲤未离"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>读 TXT 文件-作者：锦鲤未离</title> <style> body { justify-content: space-between; height: 100%; margin: 0; padding: 0; background-color: #faebd7; } .hidden { display: none; } pre { font-family: inherit; white-space: pre-wrap; tab-size: 2; } button { border: none; outline: none; background: #faebd7ef; cursor: pointer; border: 1px solid orange; border-radius: 20px; padding: 8px 16px; color: orange; font-size: 13px; } button:hover { background-color: #ffa500; color: #ffffff; border-color: orange; } #folderInput, #fileInput { width: 0%; opacity: 0; position: absolute; z-index: -1; } #folderInput+label, #fileInput+label { display: inline-block; border: 1px solid orange; border-radius: 20px; padding: 8px 16px; color: orange; font-size: 13px; cursor: pointer; } #folderInput+label:hover, #fileInput+label:hover { background-color: #ffa500; color: #ffffff; border-color: orange; } #fileListContainer { min-width: 23%; max-width: 45%; position: fixed; top: 0; left: 0; bottom: 0; padding: 10px; box-sizing: border-box; background: #faebd7ed; overflow: auto; scrollbar-width: none; -ms-overflow-style: none; } #fileListContainer::-webkit-scrollbar { display: none; } #fileContent h2 { margin-top: 60px; } #fileContentContainer { display: flex; flex-direction: column; flex: 1; overflow-y: auto; box-sizing: border-box; } #topControls { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); } #fontSizeRangediv { display: inline-block; } #fontSizeRangediv input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 10px; background: #ffa500; border-radius: 5px; outline: none; margin: 10px 0; } #fileList { display: flex; flex-wrap: wrap; width: 65%; margin: 0 auto; justify-content: center; margin-top: 10px; position: absolute; left: 50%; transform: translateX(-50%); } #fileList div { padding: 0 5px 0 5px; } #fileList div:hover { padding: 0 3.7px 0 3.7px; } #fileList.hidden, #fileContent.hidden { display: none; } .chapter-link { display: block; } #fileList div a, #chapterLinks a { display: block; text-decoration: none; color: #b24224; padding-bottom: 5px; padding-top: 5px; } #fileList div a:hover, #fileListContainer div a:hover { font-weight: bold; } #fileContent { font-size: 20px; margin: 0 27px 0 27px; overflow-y: auto; overflow-x: hidden; } .dark-mode { background-color: #000000; } .dark-mode #fileListContainer { background-color: #000000ed; } .dark-mode button, .dark-mode #folderInput+label, .dark-mode #fileInput+label { border: 1px solid #ffa50090; color: #ffa50090; background: #000000ef; } .dark-mode button:hover, .dark-mode #folderInput+label:hover, .dark-mode #fileInput+label:hover { background-color: #ffa50090; color: #ffffff90; border-color: #ffa50090; } .dark-mode #fileList div a, .dark-mode #chapterLinks a { color: #b2422490; } .dark-mode #fileContentContainer, .dark-mode #chapterLinks h1 { color: #ffffff90; } .dark-mode #fontSizeRangediv input[type="range"] { background: #ffa50080; } @media (min-width: 0px) { #fileContent { padding: 120px 10px; } #fileList { width: 90%; } } @media (min-width: 700px) { #fileContent { padding: 60px 100px; } #fileList { width: 80%; } } @media (min-width: 1024px) { #fileContent { padding: 30px 180px; } #fileList { width: 70%; } } @media (min-width: 1366px) { #fileContent { padding: 15px 310px; } #fileList { width: 65%; } } </style> </head> <body id="body"> <div id="fileListContainer" style="display: none;"> <div id="chapterLinks"></div> </div> <div id="fileContentContainer"> <div id="topControls"> <button id="toggleDarkModeBtn">切换暗色(D)</button> <input type="file" id="folderInput" webkitdirectory directory multiple /> <label for="folderInput" id="folderInputLabel">选择书库(Enter)</label> <input type="file" id="fileInput" multiple /> <label for="fileInput" id="fileInputLabel">选择书籍</label> <button id="fileReselect">重置界面(R)</button> <button id="toggleChapterLinksBtn" style="display: none;">书籍目录(L)</button> <button id="backToListBtn" style="display: none;">返回书库(Alt)</button> <div id="fontSizeRangediv" style="display: none;"> <input type="range" id="fontSizeRange" min="10" max="30" value="20" step="1"> </div> </div> <div id="fileList"></div> <pre id="fileContent" class="hidden"></pre> </div> <script> var zzbds = '[　 第]*[零一二三四五六七八九十百千 至到0-9]+[章篇卷梦].*?|\\n[　 ]*番外\\d*.*?|\\n[　 ]*[0-9]+[．、.].*?|书籍介绍.*?'; function FilesInputAfter(files) { var fileListDiv = document.getElementById('fileList'); fileListDiv.innerHTML = ""; for (var i = 0; i < files.length; i++) { var file = files[i]; if (file.name.endsWith('.txt')) { var listItem = document.createElement('div'); var link = document.createElement('a'); link.textContent = file.name.split('.').slice(0, -1).join('.'); link.href = "#"; link.addEventListener('click', function (file) { return function () { readFileContent(file); hideFileList(); showButton(); }; }(file)); listItem.appendChild(link); fileListDiv.appendChild(listItem); } } } function hideFileList() { document.getElementById('fileList').classList.add('hidden'); document.getElementById('folderInputLabel').style.display = 'none'; document.getElementById('fileInputLabel').style.display = 'none'; } function showButton() { document.getElementById('backToListBtn').style.display = ''; document.getElementById('toggleChapterLinksBtn').style.display = ''; document.getElementById('fontSizeRangediv').style.display = ''; } var MaxcurrentChapterIndex = 0; var chapterPattern = new RegExp(`(${zzbds}|\\n)(?=\\n${zzbds}|\\n?$)`, 'gs'); var introMatching = new RegExp(`[\\s\\S]*?(?=${zzbds})`); function readFileContent(file) { var reader = new FileReader(); reader.onload = function (e) { var contents = "书籍介绍" + '\n' + e.target.result; var fileContent = document.getElementById('fileContent'); fileContent.innerHTML = ""; var chapterLinksDiv = document.getElementById('chapterLinks'); chapterLinksDiv.innerHTML = ""; var bookTitleElement = document.createElement('h1'); bookTitleElement.textContent = file.name.split('.').slice(0, -1).join('.'); chapterLinksDiv.appendChild(bookTitleElement); var introMatch = contents.match(introMatching); var introContent = introMatch ? introMatch[0] : ''; if (introContent) { var introElement = document.createElement('pre'); introElement.innerHTML = introContent.replace(/\n/g, '<br>'); fileContent.appendChild(introElement); } var matches; var index = 1; chapterPattern.lastIndex = 0; while ((matches = chapterPattern.exec(contents)) !== null) { var chapterContent = matches[0].trim(); var chapterTitle = chapterContent.split('\n')[0].trim(); var chapterLink = document.createElement('a'); chapterLink.textContent = chapterTitle; chapterLink.href = "#chapter" + index; chapterLink.className = 'chapter-link'; chapterLinksDiv.appendChild(chapterLink); var chapterAnchor = document.createElement('a'); chapterAnchor.name = "chapter" + index; fileContent.appendChild(chapterAnchor); var chapterHeader = document.createElement('h2'); chapterHeader.textContent = chapterTitle; fileContent.appendChild(chapterHeader); var chapterParagraph = document.createElement('pre'); chapterParagraph.textContent = chapterContent; fileContent.appendChild(chapterParagraph); index++; MaxcurrentChapterIndex = index; } fileContent.classList.remove('hidden'); }; reader.readAsText(file); } var folderOrfileInput = 0; document.getElementById('folderInput').addEventListener('change', function (e) { folderOrfileInput = 0; document.getElementById('fileInputLabel').style.display = 'none'; document.getElementById('folderInputLabel').textContent = '重选书库(Enter)'; FilesInputAfter(e.target.files); }); document.getElementById('fileInput').addEventListener('change', function (e) { folderOrfileInput = 1; document.getElementById('folderInputLabel').style.display = 'none'; document.getElementById('fileInputLabel').textContent = '重选书籍'; FilesInputAfter(e.target.files); }); document.getElementById('fileReselect').addEventListener('click', function () { location.reload(); }); document.getElementById('toggleChapterLinksBtn').addEventListener('click', function () { document.getElementById('fileListContainer').classList.toggle('hidden'); }); document.getElementById('toggleDarkModeBtn').addEventListener('click', function () { document.body.classList.toggle('dark-mode'); }); document.getElementById('fontSizeRange').addEventListener('input', function () { document.getElementById('fileContent').style.fontSize = document.getElementById('fontSizeRange').value + 'px'; }); document.getElementById('backToListBtn').addEventListener('click', function () { document.getElementById('fileList').classList.remove('hidden'); fileListContainer.style.display = 'none'; document.getElementById('fileContent').classList.add('hidden'); document.getElementById('chapterLinks').innerHTML = ''; document.getElementById('fileContent').innerHTML = ''; document.getElementById('backToListBtn').style.display = 'none'; document.getElementById('toggleChapterLinksBtn').style.display = 'none'; document.getElementById('fontSizeRangediv').style.display = 'none'; if (folderOrfileInput == 0) { document.getElementById('folderInputLabel').style.display = ''; } else { document.getElementById('fileInputLabel').style.display = ''; } }); document.addEventListener('DOMContentLoaded', function () { topControlsOffsetHeight = document.getElementById('topControls').offsetHeight + 30 + 'px'; document.getElementById('fileList').style.marginTop = topControlsOffsetHeight; document.getElementById('fileContent').style.marginTop = topControlsOffsetHeight; }); const fileList = document.getElementById('fileList'); if (!fileList.hasChildNodes()) { var comment = document.createElement('p'); comment.innerHTML = "锦鲤未离书库小提示：<br><br>" + "1. 可以通过“导入书库（即选择文件夹）”或“导入书籍（即选择文件）”两种方式进行导入。<br>" + "需要注意的是，系统会自动筛选所有txt文件进行导入。<br>" + "在“导入书籍（即选择文件）”时，可以一次性导入多个文件。<br><br>" + "2. 在进入书籍阅读界面时，点按一次除目录外的区域即可隐藏目录，再次点按可以展开。<br><br>" + "3. 网站支持快捷键。左右键可以跳转到上下章;<br>" + "D、Enter、R、L、Alt键分别表示按下暗色模式、选择书库、重置页面、显隐章节目录、返回书籍列表操作。<br>"; fileList.appendChild(comment); } document.addEventListener('click', function (event) { var fileListContainer = document.getElementById('fileListContainer'); var isClickInsidefileListContainer = fileListContainer.contains(event.target); var isClickInsidetoggleDarkModeBtn = toggleDarkModeBtn.contains(event.target); var isClickInsidefontSizeRangediv = fontSizeRangediv.contains(event.target); if (!isClickInsidefileListContainer && !isClickInsidetoggleDarkModeBtn && !isClickInsidefontSizeRangediv && fileList.classList.contains('hidden')) { if (fileListContainer.style.display === 'none' || fileListContainer.style.display === '') { fileListContainer.style.display = 'block'; } else { fileListContainer.style.display = 'none'; } } }); function handleKeyboardEvent(event) { if (event.keyCode === 39 || event.keyCode === 37) { event.preventDefault(); var currentHash = window.location.hash; var currentChapter; if (currentHash.startsWith("#chapter")) { currentChapter = parseInt(currentHash.substring(8)); } else { currentChapter = 1; } var nextChapter; if (event.keyCode === 39) { nextChapter = Math.min(currentChapter + 1, MaxcurrentChapterIndex - 1); } else if (event.keyCode === 37) { nextChapter = Math.max(currentChapter - 1, 1); } var nextChapterAnchor = '#chapter' + nextChapter; location.hash = nextChapterAnchor; } } document.addEventListener('keydown', handleKeyboardEvent); document.addEventListener('keydown', function (event) { if (event.altKey) { document.getElementById('backToListBtn').click(); } }); document.addEventListener('keydown', function (event) { if (folderInputLabel.style.display !== 'none') { if (event.key === "Enter") { document.getElementById('folderInput').click(); } } }); document.addEventListener('keydown', function (event) { if (event.keyCode === 68) { document.getElementById('toggleDarkModeBtn').click(); } }); document.addEventListener('keydown', function (event) { if (event.keyCode === 82) { document.getElementById('fileReselect').click(); } }); document.addEventListener('keydown', function (event) { if (event.keyCode === 76) { document.getElementById('toggleChapterLinksBtn').click(); } }); </script> <script src="https://koinl.github.io/js/logo.js"></script> </body> </html>
